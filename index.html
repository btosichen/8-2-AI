<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI å´›èµ·ï¼šæœªä¾†ä¸–ç•Œäº’å‹•å­¸ç¿’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-blue: #00f2ff;
            --neon-purple: #bc13fe;
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .neon-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(188, 19, 254, 0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .ai-energy-bar {
            height: 12px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }

        .ai-energy-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neon-blue), var(--neon-purple));
            width: 0%;
            transition: width 0.5s ease;
        }

        .btn-neon {
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-purple));
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .study-note {
            border-left: 4px solid var(--neon-purple);
            background: white;
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 12px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            transition: all 0.3s;
        }

        .study-note.read {
            border-left-color: #4ade80;
            background: rgba(74, 222, 128, 0.05);
        }

        .icon-box {
            background: #f3f4f6;
            padding: 10px;
            border-radius: 12px;
            font-size: 1.5rem;
            min-width: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .video-container {
            position: relative;
            padding-bottom: 56.25%;
            height: 0;
            overflow: hidden;
            border-radius: 12px;
            margin-top: 10px;
        }

        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .wrong-shake { animation: shake 0.3s ease-in-out 2; border-color: #ff4d4d !important; }

        @keyframes glow {
            0% { box-shadow: 0 0 5px #4ade80; }
            50% { box-shadow: 0 0 20px #4ade80; }
            100% { box-shadow: 0 0 5px #4ade80; }
        }

        .correct-glow { animation: glow 0.5s ease-in-out; border-color: #4ade80 !important; }

        .hidden { display: none; }
    </style>
</head>
<body class="p-4 md:p-8">

    <!-- ç™»å…¥é é¢ -->
    <div id="login-screen" class="max-w-md mx-auto neon-card p-8 mt-10">
        <h1 class="text-3xl font-bold text-center mb-2 text-gray-800">ğŸ¤– AI å´›èµ·ï¼šæœªä¾†æ–°ä¸–ç•Œ</h1>
        <p class="text-center text-gray-500 mb-8 text-sm">âœ¨ å®Œæˆ 20 é¡ŒæŒ‘æˆ°ä¸¦è§€çœ‹å½±ç‰‡ âœ¨</p>
        <div class="space-y-4">
            <select id="user-class" class="w-full p-3 rounded-lg border bg-white">
                <option value="">é¸æ“‡ç­ç´š</option>
                <option value="801">801</option>
                <option value="802">802</option>
                <option value="803">803</option>
                <option value="804">804</option>
                <option value="805">805</option>
                <option value="806">806</option>
            </select>
            <input type="number" id="user-no" placeholder="åº§è™Ÿ" class="w-full p-3 rounded-lg border focus:ring-2 focus:ring-purple-400">
            <input type="text" id="user-name" placeholder="å§“å" class="w-full p-3 rounded-lg border focus:ring-2 focus:ring-purple-400">
            <button onclick="startApp()" class="w-full btn-neon mt-4">é–‹å§‹å­¸ç¿’èˆ‡æ¸¬é©— ğŸš€</button>
        </div>
    </div>

    <!-- å­¸ç¿’èˆ‡æ¸¬é©—ä¸»å®¹å™¨ -->
    <div id="game-container" class="max-w-6xl mx-auto hidden">
        <div class="flex flex-wrap justify-between items-center mb-6 bg-white p-4 rounded-xl shadow-sm">
            <div class="flex items-center space-x-4">
                <span class="font-bold text-purple-600" id="display-info"></span>
                <div class="ai-energy-bar w-32 md:w-64">
                    <div id="energy-fill" class="ai-energy-fill"></div>
                </div>
            </div>
            <div class="flex space-x-4">
                <div class="bg-blue-50 px-4 py-1 rounded-full border border-blue-100 text-center">
                    <span class="text-[10px] block text-blue-500 font-bold">TIMER</span>
                    <span id="timer-text" class="font-bold text-blue-700">0s</span>
                </div>
                <div class="bg-purple-50 px-4 py-1 rounded-full border border-purple-100 text-center">
                    <span class="text-[10px] block text-purple-500 font-bold">SCORE</span>
                    <span id="score-text" class="font-bold text-purple-700">0</span>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- å·¦å´ï¼šæ•™æé‡é»èˆ‡å½±ç‰‡ -->
            <div class="lg:col-span-1">
                <div class="neon-card p-5 min-h-[550px] bg-gray-50/50 flex flex-col">
                    <h3 class="font-bold text-lg mb-4 text-purple-700 border-b pb-2 flex justify-between">
                        <span>ğŸ“– å½±ç‰‡èˆ‡æ€è€ƒ</span>
                        <span id="read-status" class="text-[10px] bg-gray-200 px-2 py-0.5 rounded-full">æœªå®Œæˆ</span>
                    </h3>
                    <div id="study-notes" class="flex-grow overflow-y-auto space-y-4"></div>
                    <button id="btn-confirm-read" onclick="markAsRead()" class="w-full py-3 mt-4 bg-white text-purple-600 rounded-xl font-bold border border-purple-200 hover:bg-purple-50 transition-colors">æˆ‘çœ‹å®Œäº†ï¼(+5%)</button>
                </div>
            </div>

            <!-- å³å´ï¼šé¡Œç›®å€ -->
            <div class="lg:col-span-3">
                <div id="level-nav" class="grid grid-cols-4 gap-2 mb-6 text-xs md:text-sm">
                    <button id="nav-1" class="p-3 rounded-xl bg-white shadow-sm font-bold text-gray-300" disabled>1.åŸç†å²</button>
                    <button id="nav-2" class="p-3 rounded-xl bg-white shadow-sm font-bold text-gray-300" disabled>2.æ³•å¾‹å€«ç†</button>
                    <button id="nav-3" class="p-3 rounded-xl bg-white shadow-sm font-bold text-gray-300" disabled>3.é ˜åŸŸæ‡‰ç”¨</button>
                    <button id="nav-4" class="p-3 rounded-xl bg-white shadow-sm font-bold text-gray-300" disabled>4.æœªä¾†è¶¨å‹¢</button>
                </div>
                <div id="question-box" class="neon-card p-8 min-h-[480px] bg-white relative">
                    <div id="rush-timer" class="absolute top-6 right-6 w-14 h-14 rounded-full border-4 border-orange-400 flex items-center justify-center font-bold text-orange-600 bg-orange-50 hidden">10</div>
                    <div id="content-area"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- çµç®—é é¢ -->
    <div id="result-screen" class="max-w-md mx-auto neon-card p-8 mt-10 text-center hidden">
        <div class="text-7xl mb-4">ğŸ†</div>
        <h2 class="text-3xl font-bold mb-2">æŒ‘æˆ°çµæŸ</h2>
        <div id="uploading-status" class="text-blue-500 text-sm mb-4 animate-pulse">æ­£åœ¨ä¸Šå‚³æˆç¸¾è¨˜éŒ„...</div>
        <div class="bg-white p-6 rounded-2xl border border-purple-100 space-y-4 mb-8 text-left">
            <div class="flex justify-between"><span>åŸå§‹å¾—åˆ†ï¼š</span><span id="final-raw-score" class="font-bold"></span></div>
            <div id="bonus-row" class="flex justify-between text-green-600 hidden"><span>ğŸ“š è‡ªå­¸çå‹µï¼š</span><span class="font-bold">+5%</span></div>
            <div class="flex justify-between text-2xl border-t pt-4 font-bold"><span>ç¸½æˆç¸¾ï¼š</span><span id="final-score" class="text-purple-600"></span></div>
        </div>
        <button onclick="location.reload()" class="w-full btn-neon">é‡æ–°æŒ‘æˆ° ğŸŒŸ</button>
    </div>

    <script>
        const _A = (s) => btoa(encodeURIComponent(s));
        // GAS URL ä¿æŒä¸è®Š
        const gasUrl = "https://script.google.com/macros/s/AKfycbzucU67nYMhc6hdjV2E1Z5mPckxnhHMmjegb0YHqbizKWMblQ8x6N7LeJfsPY_CK6Ddgg/exec";

        const levelsData = [
            {
                level: 1, title: "AI åŸç†èˆ‡ç™¼å±•å²",
                notes: [
                    { icon: "ğŸï¸", t: "å½±ç‰‡ï¼šAI äººå·¥æ™ºæ…§å´›èµ·", video: "rSajTSVvPYA", q: "æ€è€ƒï¼šå¾æ—©æœŸã€æ·±è—ã€åˆ°ç¾åœ¨çš„ã€ChatGPTã€ï¼ŒAI çš„å­¸ç¿’æ–¹å¼ç™¼ç”Ÿäº†ä»€éº¼è½‰è®Šï¼Ÿ" },
                    { icon: "ğŸ§ ", t: "æ ¸å¿ƒæŠ€è¡“", d: "LLM å¤§å‹èªè¨€æ¨¡å‹é€éæµ·é‡æ•¸æ“šé æ¸¬ä¸‹ä¸€å€‹å­—ï¼Œé€™å°±æ˜¯å®ƒçš„ã€æ€è€ƒã€æ–¹å¼ã€‚" }
                ],
                questions: [
                    { type: 'tf', q: "æ—©æœŸæ“Šæ•—äººé¡æ£‹æ‰‹çš„ AI (å¦‚æ·±è—) ä¸»è¦æ˜¯ä¾é é è¨­çš„ã€è¦å‰‡ã€è€Œéè‡ªä¸»å­¸ç¿’ã€‚", a: "VHJ1ZQ==" },
                    { type: 'choice', q: "æ ¹æ“šå½±ç‰‡ï¼Œç¾ä»£ AI èƒ½å¤ è®Šè°æ˜çš„é—œéµåœ¨æ–¼å“ªé …æŠ€è¡“ï¼Ÿ", options: ["æ›´å¥½çš„ç¶²è·¯é€£æ¥", "æ·±åº¦å­¸ç¿’èˆ‡ç¥ç¶“ç¶²è·¯", "æ›´å¤§çš„è¢å¹•è§£æåº¦", "æ›´è²´çš„é›»è…¦é›¶ä»¶"], a: "æ·±åº¦å­¸ç¿’èˆ‡ç¥ç¶“ç¶²è·¯" },
                    { type: 'choice', q: "ç”Ÿæˆå¼ AIï¼ˆå¦‚ ChatGPTï¼‰çš„ä¸»è¦é‹ä½œåŸç†æ˜¯ä»€éº¼ï¼Ÿ", options: ["ç¿»é–±å¯¦é«”å­—å…¸", "æ ¹æ“šæ©Ÿç‡é æ¸¬ä¸‹ä¸€å€‹æœ€å¯èƒ½çš„å­—", "æœ‰äººåœ¨å¾Œå°å·å·æ‰“å­—å›è¦†", "å–®ç´”çš„è¤‡è£½è²¼ä¸Š"], a: "æ ¹æ“šæ©Ÿç‡é æ¸¬ä¸‹ä¸€å€‹æœ€å¯èƒ½çš„å­—" },
                    { type: 'tf', q: "AI æœ‰æ™‚æœƒç”¢ç”Ÿã€å¹»è¦ºã€ï¼ˆå‡è³‡è¨Šï¼‰ï¼Œé€™æ˜¯å› ç‚ºå®ƒæ˜¯åœ¨è¨ˆç®—æ©Ÿç‡è€ŒéæŸ¥è­‰äº‹å¯¦ã€‚", a: "VHJ1ZQ==" },
                    { type: 'choice', q: "ä¸‹åˆ—å“ªä¸€å€‹ä¸æ˜¯ç”Ÿæˆå¼ AI å¯ä»¥ç”¢å‡ºçš„å…§å®¹ï¼Ÿ", options: ["æ–‡å­—æ–‡ç« ", "ç•«ä½œåœ–ç‰‡", "éŸ³æ¨‚æ—‹å¾‹", "å¯¦é«”æ¼¢å ¡"], a: "å¯¦é«”æ¼¢å ¡" }
                ]
            },
            {
                level: 2, title: "æ³•å¾‹èˆ‡å€«ç†è­°é¡Œ",
                notes: [
                    { icon: "ğŸ¥", t: "å½±ç‰‡ï¼šç”Ÿæˆå¼ AI èˆ‡è‘—ä½œæ¬Š", video: "N0mD0F_i0m8", q: "æ€è€ƒï¼šAI ç”¢ç”Ÿçš„ä½œå“å¦‚æœæ²’æœ‰äººé¡çš„ç¨å‰µæ€§è²¢ç»ï¼Œåœ¨æ³•å¾‹ä¸Šèƒ½å—åˆ°ä¿è­·å—ï¼Ÿ" },
                    { icon: "âš–ï¸", t: "ç¶²è·¯æ³•å¾‹", d: "ç¾å¯¦æ³•å¾‹åŒæ¨£ç´„æŸç¶²è·¯è¡Œç‚ºã€‚ä¾µæ¬Šèˆ‡è³‡å®‰é¢¨éšªæ˜¯ä½¿ç”¨ AI æ™‚å¿…é ˆæ³¨æ„çš„é‡é»ã€‚" }
                ],
                questions: [
                    { type: 'tf', q: "é›–ç„¶æ˜¯ AI ç”Ÿæˆçš„å…§å®¹ï¼Œä½†åœ¨ç¶²è·¯ä¸Šæ•£å¸ƒè¬ è¨€ä¾ç„¶è¦è² æ³•å¾‹è²¬ä»»ã€‚", a: "VHJ1ZQ==" },
                    { type: 'choice', q: "æ•™è‚²éƒ¨å½±ç‰‡æé†’ï¼Œæˆ‘å€‘åœ¨ä½¿ç”¨ AI å·¥å…·æ™‚ï¼Œæœ€ä¸è©²ä¸Šå‚³ä»€éº¼è³‡æ–™ï¼Ÿ", options: ["ä»Šå¤©çš„å¤©æ°£é å ±", "è‡ªå·±çš„èº«åˆ†è­‰å­—è™Ÿèˆ‡éš±ç§æ–‡ä»¶", "è‹±æ–‡å–®å­—åˆ—è¡¨", "é£Ÿè­œ"], a: "è‡ªå·±çš„èº«åˆ†è­‰å­—è™Ÿèˆ‡éš±ç§æ–‡ä»¶" },
                    { type: 'choice', q: "é—œæ–¼ AI ç”Ÿæˆç•«ä½œçš„è‘—ä½œæ¬Šï¼Œä¸‹åˆ—æ•˜è¿°ä½•è€…æ­£ç¢ºï¼Ÿ", options: ["ç‰ˆæ¬Šå®Œå…¨å±¬æ–¼é›»è…¦è»Ÿé«”", "ç‰ˆæ¬Šæ­¸ OpenAI å…¬å¸æ‰€æœ‰", "éœ€ä¾äººé¡æŒ‡ä»¤çš„å…·é«”ç¨‹åº¦åˆ¤æ–·æ˜¯å¦å…·è‘—ä½œæ¬Š", "èª°å…ˆçœ‹åˆ°å°±æ­¸èª°"], a: "éœ€ä¾äººé¡æŒ‡ä»¤çš„å…·é«”ç¨‹åº¦åˆ¤æ–·æ˜¯å¦å…·è‘—ä½œæ¬Š" },
                    { type: 'tf', q: "å³ä½¿æ˜¯ä½¿ç”¨ AI å¹«å¿™å¯«ä½œæ¥­ï¼Œè‹¥ç›´æ¥æŠ„è¥²ä»–äººç‰ˆæ¬Šå…§å®¹è€Œä¸æ¨™è¨»ä¾†æºï¼Œä»å¯èƒ½æœ‰ä¾µæ¬Šé¢¨éšªã€‚", a: "VHJ1ZQ==" },
                    { type: 'choice', q: "åœ¨è³‡è¨Šå€«ç†ä¸­ï¼Œã€æ¨™è¨» AI ç”Ÿæˆä¾†æºã€çš„ä¸»è¦ç›®çš„æ˜¯ï¼Ÿ", options: ["è®“é›»è…¦é«˜èˆˆ", "è½å¯¦èª ä¿¡ä¸¦å°å…§å®¹è² è²¬", "å¢åŠ å­—æ•¸", "æ¸›å°‘é›»è…¦é›»é‡æ¶ˆè€—"], a: "è½å¯¦èª ä¿¡ä¸¦å°å…§å®¹è² è²¬" }
                ]
            },
            {
                level: 3, title: "å„é ˜åŸŸ AI æ‡‰ç”¨",
                notes: [
                    { icon: "ğŸ¥", t: "å½±ç‰‡ï¼šAI åœ¨é†«ç™‚çš„æ©Ÿæœƒ", video: "N-CUqF7Xfww", q: "æ€è€ƒï¼šå°å¤§é†«é™¢å°ˆå®¶æåˆ°ï¼ŒAI åœ¨åˆ¤è®€å½±åƒä¸Šæ¯”äººé¡å¿«ä¸”ç©©ï¼Œé†«ç”Ÿçš„è§’è‰²å°‡è½‰å‘ä½•è™•ï¼Ÿ" },
                    { icon: "ğŸš—", t: "ç”Ÿæ´»èˆ‡äº¤é€š", d: "å¾è‡ªé§•è¼”åŠ©åˆ°æ™ºæ…§ç›£æ¸¬ç¡çœ ï¼ŒAI æ­£åœ¨å…¨é¢æ¥æ‰‹æˆ‘å€‘ç”Ÿæ´»ä¸­çš„é‡è¤‡æ€§åˆ†æå·¥ä½œã€‚" }
                ],
                questions: [
                    { type: 'choice', q: "å°å¤§é†«é™¢é†«å¸«æåˆ°ï¼ŒAI åœ¨é†«ç™‚ä¸Šæœ€é‡è¦çš„è²¢ç»ä¹‹ä¸€æ˜¯ï¼Ÿ", options: ["å–ä»£æ‰€æœ‰è­·ç†å¸«", "ç²¾æº–è¼”åŠ©å½±åƒè¨ºæ–·ï¼Œé™ä½é†«å¸«ç–²å‹éŒ¯èª¤", "ç™¼æ˜é•·ç”Ÿä¸è€è—¥", "è‡ªå‹•å¹«ç—…äººä»˜è²»"], a: "ç²¾æº–è¼”åŠ©å½±åƒè¨ºæ–·ï¼Œé™ä½é†«å¸«ç–²å‹éŒ¯èª¤" },
                    { type: 'choice', q: "æ™ºæ…§æ‰‹ç’°ç›£æ¸¬å¿ƒè·³èˆ‡ç¡çœ ï¼Œæ˜¯å±¬æ–¼ AI åœ¨å“ªå€‹é ˜åŸŸçš„æ‡‰ç”¨ï¼Ÿ", options: ["é¤é£²æœå‹™", "å€‹äººå¥åº·ç®¡ç†", "å¤ªç©ºæ¢ç´¢", "å»ºç¯‰å·¥ç¨‹"], a: "å€‹äººå¥åº·ç®¡ç†" },
                    { type: 'rush', q: "ã€æ¶ç­”ï¼ã€‘AI æƒ…ç·’åµæ¸¬ç³»çµ±ä¸»è¦é€éä»€éº¼ä¾†åˆ¤æ–·å­¸ç”Ÿçš„å¿ƒæƒ…ï¼Ÿ", options: ["æƒæå£è¢‹", "åˆ†æèªéŸ³ã€æ–‡å­—åŠé¢éƒ¨ç‰¹å¾µ", "è©¢å•çˆ¶æ¯", "çœ‹å­¸ç”Ÿç•¶å¤©çš„æ—©é¤"], a: "åˆ†æèªéŸ³ã€æ–‡å­—åŠé¢éƒ¨ç‰¹å¾µ" },
                    { type: 'match', q: "è«‹é…å°æ­£ç¢ºçš„æœå‹™æä¾›è€…ï¼š", pairs: [{ l: "Gemini", r: "Google", id: 2 }, { l: "ChatGPT", r: "OpenAI", id: 1 }] },
                    { type: 'choice', q: "å¦‚æœä½ è¦æ•´åˆ Google è¡Œäº‹æ›†ä¾†å®‰æ’ AI ç”Ÿæˆçš„è¡Œç¨‹ï¼Œå“ªä¸€å€‹å·¥å…·æœ€é©åˆï¼Ÿ", options: ["ChatGPT", "Gemini", "Siri", "å°æ„›åŒå­¸"], a: "Gemini" }
                ]
            },
            {
                level: 4, title: "æœªä¾†è¶¨å‹¢èˆ‡ç´ é¤Š",
                notes: [
                    { icon: "ğŸ’¡", t: "å½±ç‰‡ï¼šAI èˆ‡æœªä¾†çš„è¶¨å‹¢", video: "7-vnQlakK_4", q: "æ€è€ƒï¼šç•¶é‡è¤‡æ€§ä»»å‹™è¢«è‡ªå‹•åŒ–ï¼Œä½ è¦ºå¾—å“ªç¨®ã€äººé¡ç‰¹è³ªã€åœ¨æœªä¾†å·¥ä½œæœ€å€¼éŒ¢ï¼Ÿ" },
                    { icon: "ğŸš€", t: "å…±å­˜ä¹‹é“", d: "æ‰¹åˆ¤æ€§æ€è€ƒã€è·¨åŸŸå”ä½œã€æƒ…æ„Ÿåƒ¹å€¼ï¼Œæ˜¯æœªä¾†äººæ‰èˆ‡ AI å”ä½œçš„ä¸‰å¤§é—œéµã€‚" }
                ],
                questions: [
                    { type: 'choice', q: "æœªä¾†è¶¨å‹¢å½±ç‰‡ä¸­æåˆ°ï¼ŒAI ä¸»è¦æ˜¯å–ä»£äººé¡çš„ä»€éº¼ï¼Ÿ", options: ["å…¨éƒ¨çš„äººé¡åƒ¹å€¼", "é‡è¤‡æ€§é«˜ã€é‚è¼¯å›ºå®šçš„ä»»å‹™", "äººé¡çš„æƒ…æ„Ÿé€£çµ", "æ‰€æœ‰çš„å¯¦é«”å‹å‹•"], a: "é‡è¤‡æ€§é«˜ã€é‚è¼¯å›ºå®šçš„ä»»å‹™" },
                    { type: 'tf', q: "äººæ©Ÿå”ä½œ (Human-AI) çš„æ„æ€æ˜¯è®“ AI åšå®ƒæ“…é•·çš„æ•¸æ“šè™•ç†ï¼Œäººé¡åšæ±ºç­–èˆ‡å‰µæ„ã€‚", a: "VHJ1ZQ==" },
                    { type: 'choice', q: "é¢å° AI ç”Ÿæˆçš„å¤§é‡è¨Šæ¯ï¼Œæœ€é‡è¦çš„åª’é«”ç´ é¤Šæ˜¯ï¼Ÿ", options: ["å…¨éƒ¨ç›¸ä¿¡ä¸¦è½‰ç™¼", "æ‹’çµ•ä½¿ç”¨ä»»ä½•è¨Šæ¯", "å…·å‚™æ‰¹åˆ¤æ€è€ƒä¸¦ä¸»å‹•æŸ¥è­‰ä¾†æº", "åªçœ‹æ¨™é¡Œå°±ä¸‹åˆ¤æ–·"], a: "å…·å‚™æ‰¹åˆ¤æ€è€ƒä¸¦ä¸»å‹•æŸ¥è­‰ä¾†æº" },
                    { type: 'choice', q: "å“ªç¨®è·æ¥­åœ¨æœªä¾†æœ€ä¸å®¹æ˜“è¢« AI å–ä»£ï¼Ÿ", options: ["å–®ç´”çš„æ•¸æ“šè¼¸å…¥å“¡", "è¦å‰‡ç°¡å–®çš„ç¿»è­¯å“¡", "éœ€è¦é«˜åº¦åŒç†å¿ƒèˆ‡è¤‡é›œåˆ¤æ–·çš„å¿ƒç†é†«å¸«", "æ”¶éŠ€å“¡"], a: "éœ€è¦é«˜åº¦åŒç†å¿ƒèˆ‡è¤‡é›œåˆ¤æ–·çš„å¿ƒç†é†«å¸«" },
                    { type: 'tf', q: "å­¸ç¿’ä½¿ç”¨ AI å·¥å…·ï¼ˆå¦‚ AI ç´ é¤Šï¼‰å°‡æœƒåƒå­¸ç¿’æ‰“å­—ä¸€æ¨£ï¼Œæˆç‚ºæœªä¾†çš„åŸºæœ¬èƒ½åŠ›ã€‚", a: "VHJ1ZQ==" }
                ]
            }
        ];

        let currentUser = {}, currentLevel = 0, currentQIdx = 0, score = 0, totalCorrect = 0, totalTime = 0;
        let gameTimer, rushTimerInterval, readProgress = [false, false, false, false];

        function startApp() {
            const cls = document.getElementById('user-class').value;
            const no = document.getElementById('user-no').value;
            const nm = document.getElementById('user-name').value;
            if (!cls || !no || !nm) return alert("è«‹å¡«å¯«å®Œæ•´çš„ç­ç´šã€åº§è™Ÿèˆ‡å§“åï¼");
            currentUser = { class: cls, no: no, name: nm };
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('game-container').classList.remove('hidden');
            document.getElementById('display-info').innerText = `${currentUser.class} ç­ ${currentUser.no} è™Ÿ ${currentUser.name}`;
            gameTimer = setInterval(() => { totalTime++; document.getElementById('timer-text').innerText = totalTime + 's'; }, 1000);
            loadLevel(0);
        }

        function loadLevel(idx) {
            currentLevel = idx; currentQIdx = 0; updateNav(); loadQuestion(); updateNotes();
        }

        function updateNav() {
            const currentTotalIdx = levelsData.slice(0, currentLevel).reduce((acc, l) => acc + l.questions.length, 0) + currentQIdx;
            document.getElementById('energy-fill').style.width = (currentTotalIdx / 20 * 100) + '%';
            for(let i=1; i<=4; i++) {
                const nav = document.getElementById(`nav-${i}`);
                nav.className = `p-3 rounded-xl shadow-sm font-bold ${i-1 === currentLevel ? 'bg-purple-600 text-white scale-105' : i-1 < currentLevel ? 'bg-green-500 text-white' : 'bg-white text-gray-300'}`;
            }
        }

        function updateNotes() {
            const container = document.getElementById('study-notes');
            const isRead = readProgress[currentLevel];
            container.innerHTML = levelsData[currentLevel].notes.map(n => `
                <div class="study-note ${isRead ? 'read' : ''}">
                    <div class="icon-box">${n.icon}</div>
                    <div class="w-full">
                        <h4 class="font-bold text-sm text-purple-800">${n.t}</h4>
                        ${n.d ? `<p class="text-[11px] text-gray-500 mt-1">${n.d}</p>` : ''}
                        ${n.video ? `
                            <div class="video-container">
                                <iframe src="https://www.youtube.com/embed/${n.video}" frameborder="0" allowfullscreen></iframe>
                            </div>
                            <p class="text-[10px] text-orange-600 font-bold mt-2">ğŸ’¡ ${n.q}</p>
                        ` : ''}
                    </div>
                </div>
            `).join('');
            const btn = document.getElementById('btn-confirm-read');
            btn.disabled = isRead; btn.innerText = isRead ? "æŒæ¡é€²åº¦ âœ…" : "æˆ‘è®€å®Œäº†ï¼(+5%)";
            btn.className = isRead ? "w-full py-3 mt-4 bg-gray-100 text-gray-400 rounded-xl font-bold border border-gray-200 cursor-not-allowed" : "w-full py-3 mt-4 bg-white text-purple-600 rounded-xl font-bold border border-purple-200 hover:bg-purple-50 transition-colors";
        }

        function markAsRead() { readProgress[currentLevel] = true; updateNotes(); }

        function loadQuestion() {
            const q = levelsData[currentLevel].questions[currentQIdx];
            const area = document.getElementById('content-area');
            const box = document.getElementById('question-box');
            box.classList.remove('correct-glow', 'wrong-shake');
            document.getElementById('rush-timer').classList.add('hidden');
            clearInterval(rushTimerInterval);

            let html = `<div class="mb-6"><span class="bg-purple-100 text-purple-600 px-3 py-1 rounded-full text-xs font-bold mb-2">é¡Œ ${totalCorrect + 1} / 20</span><h2 class="text-xl md:text-2xl font-bold text-gray-800 mt-2">${q.q}</h2></div>`;

            if (q.type === 'tf') {
                html += `<div class="grid grid-cols-2 gap-6 mt-8"><button onclick="checkAns('True')" class="py-12 border-2 rounded-3xl text-6xl bg-white hover:bg-blue-50 transition-all shadow-sm active:scale-95">â­•</button><button onclick="checkAns('False')" class="py-12 border-2 rounded-3xl text-6xl bg-white hover:bg-red-50 transition-all shadow-sm active:scale-95">âŒ</button></div>`;
            } else if (q.type === 'choice' || q.type === 'rush') {
                if(q.type === 'rush') { document.getElementById('rush-timer').classList.remove('hidden'); startRush(10); }
                html += `<div class="space-y-3">${q.options.map(o => `<button onclick="checkAns('${o}')" class="w-full p-4 text-left border-2 rounded-2xl bg-white hover:bg-purple-50 hover:border-purple-400 transition-all font-bold text-sm text-gray-700 active:scale-[0.98] shadow-sm">${o}</button>`).join('')}</div>`;
            } else if (q.type === 'match') {
                html += `
                    <div class="flex gap-4">
                        <div class="flex-1 space-y-3">${levelsData[currentLevel].questions[currentQIdx].pairs.map((p,i)=>`<button id="l-${p.id}" onclick="selM('l',${p.id})" class="w-full p-4 border rounded-xl bg-gray-50 font-bold transition-all shadow-sm">${p.l}</button>`).join('')}</div>
                        <div class="flex-1 space-y-3">${[{r:'Google',id:2},{r:'OpenAI',id:1}].map((p,i)=>`<button id="r-${p.id}" onclick="selM('r',${p.id})" class="w-full p-4 border rounded-xl bg-gray-50 font-bold transition-all shadow-sm">${p.r}</button>`).join('')}</div>
                    </div>
                    <button id="ms" onclick="checkM()" class="btn-neon w-full mt-8 opacity-50 cursor-not-allowed" disabled>ç¢ºèªé…å°</button>
                `;
            }
            area.innerHTML = html;
        }

        function startRush(s) {
            let left = s; document.getElementById('rush-timer').innerText = left;
            rushTimerInterval = setInterval(() => { 
                left--; document.getElementById('rush-timer').innerText = left; 
                if(left <= 3) document.getElementById('rush-timer').classList.add('animate-pulse', 'text-red-600');
                if(left<=0) { clearInterval(rushTimerInterval); handleAns(false); } 
            }, 1000);
        }

        let sL, sR, mtch = [];
        window.selM = (side, id) => {
            if(side==='l') { sL=id; document.querySelectorAll("[id^='l-']").forEach(b=>b.className="w-full p-4 border rounded-xl bg-gray-50 font-bold shadow-sm"); document.getElementById(`l-${id}`).className="w-full p-4 border-2 border-purple-400 bg-purple-50 font-bold shadow-sm"; }
            else { sR=id; document.querySelectorAll("[id^='r-']").forEach(b=>b.className="w-full p-4 border rounded-xl bg-gray-50 font-bold shadow-sm"); document.getElementById(`r-${id}`).className="w-full p-4 border-2 border-purple-400 bg-purple-50 font-bold shadow-sm"; }
            if(sL && sR) { 
                mtch = mtch.filter(m=>m.l!==sL); mtch.push({l:sL, r:sR}); 
                document.getElementById(`l-${sL}`).classList.add('border-green-400','bg-green-50');
                document.getElementById(`r-${sR}`).classList.add('border-green-400','bg-green-50');
                sL=sR=null; 
            }
            if(mtch.length===2) { const b=document.getElementById('ms'); b.disabled=false; b.className="btn-neon w-full mt-8"; }
        };
        function checkM() { handleAns(mtch.every(m => m.l === m.r)); mtch=[]; }

        function checkAns(ans) { clearInterval(rushTimerInterval); const q = levelsData[currentLevel].questions[currentQIdx]; handleAns(q.type === 'tf' ? _A(ans) === q.a : ans === q.a); }

        function handleAns(isC) {
            const box = document.getElementById('question-box');
            if(isC) { box.classList.add('correct-glow'); score += 5; document.getElementById('score-text').innerText = score; } 
            else { box.classList.add('wrong-shake'); }
            setTimeout(() => {
                totalCorrect++;
                currentQIdx++;
                if(currentQIdx >= levelsData[currentLevel].questions.length) {
                    currentLevel++;
                    if(currentLevel >= levelsData.length) finish();
                    else loadLevel(currentLevel);
                } else { updateNav(); loadQuestion(); }
            }, 800);
        }

        function finish() {
            clearInterval(gameTimer);
            document.getElementById('game-container').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            
            const allRead = readProgress.every(r=>r);
            let final = score;
            if(allRead) { final = Math.min(100, Math.round(score * 1.05)); document.getElementById('bonus-row').classList.remove('hidden'); }
            
            document.getElementById('final-raw-score').innerText = score;
            document.getElementById('final-score').innerText = final;
            
            // é‡è¦ï¼šä¿®æ­£å‚³è¼¸é‚è¼¯ï¼Œä½¿ç”¨æ›´å¯é çš„å‚³è¼¸æ–¹å¼
            const data = {
                class: currentUser.class,
                no: currentUser.no,
                name: currentUser.name,
                rawScore: score.toString(),     // ç¢ºä¿ç‚ºå­—ä¸²
                finalScore: final.toString(),   // ç¢ºä¿ç‚ºå­—ä¸²
                bonus: allRead ? "Yes" : "No",
                timeUsed: totalTime.toString() + "s",
                timestamp: new Date().toLocaleString()
            };

            // ä½¿ç”¨ POST æäº¤
            fetch(gasUrl, {
                method: 'POST',
                mode: 'no-cors', // GAS éœ€è¦ no-cors æˆ–ç‰¹æ®Šè™•ç†ï¼Œé€™è£¡ä½¿ç”¨ no-cors ä»¥é˜²è·¨åŸŸå ±éŒ¯ï¼Œä½†æˆ‘å€‘æœƒæ”¹ç”¨ URL åƒæ•¸æˆ–æ›´ç©©å®šçš„çµæ§‹
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            }).then(() => {
                document.getElementById('uploading-status').innerText = "âœ… æˆç¸¾å·²æˆåŠŸè¨˜éŒ„æ–¼é›²ç«¯";
                document.getElementById('uploading-status').classList.remove('text-blue-500', 'animate-pulse');
                document.getElementById('uploading-status').classList.add('text-green-600');
            }).catch(err => {
                document.getElementById('uploading-status').innerText = "âš ï¸ è¨˜éŒ„å¯èƒ½æœªæˆåŠŸï¼Œè«‹æˆªåœ–ä¿å­˜ã€‚";
                console.error(err);
            });
        }
    </script>
</body>
</html>
