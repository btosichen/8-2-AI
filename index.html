<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI å´›èµ·ï¼šæœªä¾†ä¸–ç•Œäº’å‹•å­¸ç¿’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --neon-blue: #00f2ff;
            --neon-purple: #bc13fe;
            --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            overflow-x: hidden;
        }

        .neon-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(188, 19, 254, 0.1);
            border: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .neon-card:hover {
            border-color: var(--neon-blue);
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.4);
        }

        .ai-energy-bar {
            height: 12px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .ai-energy-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--neon-blue), var(--neon-purple));
            width: 0%;
            transition: width 0.5s ease;
        }

        .btn-neon {
            background: linear-gradient(45deg, var(--neon-blue), var(--neon-purple));
            color: white;
            padding: 12px 24px;
            border-radius: 50px;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .btn-neon:active {
            transform: scale(0.95);
        }

        .study-note {
            border-left: 4px solid var(--neon-purple);
            background: rgba(188, 19, 254, 0.05);
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 0 10px 10px 0;
            transition: all 0.3s;
        }

        .study-note.read {
            border-left-color: #4ade80;
            background: rgba(74, 222, 128, 0.1);
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .wrong-shake {
            animation: shake 0.3s ease-in-out 2;
            border-color: #ff4d4d !important;
        }

        @keyframes glow {
            0% { box-shadow: 0 0 5px var(--neon-blue); }
            50% { box-shadow: 0 0 25px var(--neon-blue); }
            100% { box-shadow: 0 0 5px var(--neon-blue); }
        }

        .correct-glow {
            animation: glow 0.5s ease-in-out;
            border-color: #4ade80 !important;
        }

        .hidden { display: none; }

        .drop-zone {
            min-height: 80px;
            border: 2px dashed #cbd5e1;
            border-radius: 12px;
            transition: background 0.3s;
        }

        .drop-zone.active {
            background: rgba(0, 242, 255, 0.1);
            border-color: var(--neon-blue);
        }

        .timer-badge {
            font-variant-numeric: tabular-nums;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <!-- ç™»å…¥é é¢ -->
    <div id="login-screen" class="max-w-md mx-auto neon-card p-8 mt-10">
        <h1 class="text-3xl font-bold text-center mb-6 text-gray-800">ğŸ¤– AI å´›èµ·ï¼šæœªä¾†ä¸–ç•Œ</h1>
        <p class="text-center text-gray-600 mb-8">è«‹é¸æ“‡ç­ç´šä¸¦è¼¸å…¥è³‡æ–™é–‹å§‹å­¸ç¿’</p>
        
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">ç­ç´š</label>
                <select id="user-class" class="w-full p-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-purple-400 bg-white">
                    <option value="">è«‹é¸æ“‡ç­ç´š</option>
                    <option value="801">801</option>
                    <option value="802">802</option>
                    <option value="803">803</option>
                    <option value="804">804</option>
                    <option value="805">805</option>
                    <option value="806">806</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">åº§è™Ÿ</label>
                <input type="number" id="user-no" placeholder="ä¾‹å¦‚ï¼š01" class="w-full p-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-purple-400">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">å§“å</label>
                <input type="text" id="user-name" placeholder="ç‹å°æ˜" class="w-full p-3 rounded-lg border focus:outline-none focus:ring-2 focus:ring-purple-400">
            </div>
            <button onclick="startApp()" class="w-full btn-neon mt-4">é€²å…¥ç³»çµ±</button>
            <button onclick="showAdminLogin()" class="w-full text-xs text-gray-400 hover:text-gray-600 transition">è€å¸«ç®¡ç†å¾Œå°</button>
        </div>
    </div>

    <!-- è€å¸«ç™»å…¥ä»‹é¢ -->
    <div id="admin-login" class="max-w-md mx-auto neon-card p-8 mt-10 hidden">
        <h2 class="text-2xl font-bold mb-4">ç®¡ç†å“¡é©—è­‰</h2>
        <input type="password" id="admin-pass" placeholder="è«‹è¼¸å…¥å¯†ç¢¼" class="w-full p-3 rounded-lg border mb-4">
        <div class="flex gap-2">
            <button onclick="checkAdmin()" class="flex-1 btn-neon">é©—è­‰</button>
            <button onclick="hideAdminLogin()" class="flex-1 bg-gray-200 text-gray-700 py-3 rounded-lg">å–æ¶ˆ</button>
        </div>
    </div>

    <!-- å­¸ç¿’ä¸»ç•«é¢ -->
    <div id="game-container" class="max-w-5xl mx-auto hidden">
        <div class="flex flex-wrap justify-between items-center mb-6 bg-white p-4 rounded-xl shadow-sm">
            <div class="flex items-center space-x-4">
                <span class="font-bold text-purple-600" id="display-info"></span>
                <div class="flex flex-col">
                    <span class="text-xs text-gray-500">AI èƒ½é‡å„²å‚™</span>
                    <div class="ai-energy-bar w-32 md:w-64">
                        <div id="energy-fill" class="ai-energy-fill"></div>
                    </div>
                </div>
            </div>
            <div class="flex space-x-4 items-center mt-2 md:mt-0">
                <div class="text-center px-4 py-1 bg-blue-50 rounded-full">
                    <span class="text-xs block text-blue-500">ç¸½è€—æ™‚</span>
                    <span id="timer-text" class="font-bold timer-badge">0s</span>
                </div>
                <div class="text-center px-4 py-1 bg-purple-50 rounded-full">
                    <span class="text-xs block text-purple-500">å¾—åˆ†</span>
                    <span id="score-text" class="font-bold">0</span>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- å·¦å´ï¼šå­¸ç¿’é‡é»ç­†è¨˜ -->
            <div class="lg:col-span-1 space-y-4">
                <div class="neon-card p-5 h-full flex flex-col min-h-[500px]">
                    <h3 class="font-bold text-lg mb-4 text-purple-700 border-b pb-2 flex justify-between items-center">
                        ğŸ“– å­¸ç¿’é‡é»ç­†è¨˜
                        <span id="read-status" class="text-xs bg-gray-100 px-2 py-1 rounded text-gray-500">æœªå®Œæˆé–±è®€</span>
                    </h3>
                    <div id="study-notes" class="flex-grow overflow-y-auto">
                        <!-- å‹•æ…‹å…§å®¹ -->
                    </div>
                    <div class="mt-4 pt-4 border-t">
                        <button id="btn-confirm-read" onclick="markAsRead()" class="w-full py-2 bg-gray-100 text-gray-600 rounded-lg text-sm font-bold hover:bg-green-100 hover:text-green-700 transition">
                            æˆ‘å·²é–±è®€å®Œæ­¤éƒ¨åˆ†å…§å®¹
                        </button>
                    </div>
                </div>
            </div>

            <!-- å³å´ï¼šæ¸¬é©—å€ -->
            <div class="lg:col-span-2">
                <div id="level-nav" class="grid grid-cols-3 gap-4 mb-6">
                    <button id="nav-1" class="p-4 rounded-xl bg-white shadow font-bold text-gray-400 border-b-4 border-gray-200" disabled>LEVEL 1</button>
                    <button id="nav-2" class="p-4 rounded-xl bg-white shadow font-bold text-gray-400 border-b-4 border-gray-200" disabled>LEVEL 2</button>
                    <button id="nav-3" class="p-4 rounded-xl bg-white shadow font-bold text-gray-400 border-b-4 border-gray-200" disabled>LEVEL 3</button>
                </div>

                <div id="question-box" class="neon-card p-6 md:p-10 min-h-[450px] flex flex-col relative">
                    <div id="rush-timer" class="absolute top-4 right-4 w-12 h-12 rounded-full border-4 border-orange-400 flex items-center justify-center font-bold text-orange-500 hidden">
                        10
                    </div>
                    <div id="content-area">
                        <!-- é¡Œç›®å‹•æ…‹æ’å…¥ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- çµç®—é é¢ -->
    <div id="result-screen" class="max-w-md mx-auto neon-card p-8 mt-10 text-center hidden">
        <div class="text-6xl mb-4">ğŸ†</div>
        <h2 class="text-3xl font-bold mb-2">å­¸ç¿’å®Œæˆï¼</h2>
        <p class="text-gray-600 mb-6">æˆç¸¾å·²ä¸Šå‚³è‡³é›²ç«¯ç³»çµ±</p>
        <div class="bg-gray-50 p-6 rounded-xl space-y-4 mb-8">
            <div class="flex justify-between border-b pb-2"><span>ç­”å°é¡Œæ•¸ï¼š</span><span id="final-correct" class="font-bold text-blue-600"></span></div>
            <div class="flex justify-between border-b pb-2"><span>æ¸¬é©—åŸå§‹å¾—åˆ†ï¼š</span><span id="final-raw-score" class="font-bold text-blue-600"></span></div>
            <div id="bonus-row" class="flex justify-between text-green-600 hidden">
                <span>ğŸ“š å­¸ç¿’åŠ æˆ (é–±è®€é‡é»)ï¼š</span><span class="font-bold">+5%</span>
            </div>
            <div class="flex justify-between text-xl pt-2"><span>æœ€çµ‚ç¸½å¾—åˆ†ï¼š</span><span id="final-score" class="font-bold text-purple-600"></span></div>
            <div class="flex justify-between text-sm text-gray-500"><span>ç¸½èŠ±è²»æ™‚é–“ï¼š</span><span id="final-time"></span></div>
        </div>
        <button onclick="location.reload()" class="w-full btn-neon">é‡æ–°æŒ‘æˆ°</button>
    </div>

    <script>
        const _S = "MDQyNg=="; 
        const _A = (s) => btoa(encodeURIComponent(s));

        const levelsData = [
            {
                level: 1,
                title: "LEVEL 1ï¼šAI åŸºç¤æ¦‚å¿µ",
                questions: [
                    { type: 'tf', q: "äººå·¥æ™ºæ…§ (AI) ä¸»è¦æ˜¯è®“é›»è…¦æ¨¡ä»¿äººé¡çš„æ™ºæ…§ï¼ŒåŒ…å«æ„ŸçŸ¥ã€å­¸ç¿’èˆ‡æ±ºç­–èƒ½åŠ›ã€‚", a: "VHJ1ZQ==" },
                    { type: 'choice', q: "ç›®å‰æ‰‹æ©Ÿå¸¸è¦‹çš„ã€ŒSiriã€æˆ–ã€ŒGoogle åŠ©ç†ã€ï¼Œå±¬æ–¼å“ªä¸€é¡çš„ AIï¼Ÿ", options: ["å¼·äººå·¥æ™ºæ…§ (General AI)", "å¼±äººå·¥æ™ºæ…§ (Narrow AI)", "è¶…ç´šäººå·¥æ™ºæ…§ (Super AI)", "ä»¥ä¸Šçš†é"], a: "å¼±äººå·¥æ™ºæ…§ (Narrow AI)" },
                    { type: 'drag', q: "è«‹åˆ†é¡ä»¥ä¸‹æŠ€è¡“æ˜¯å¦ä¸»è¦åŸºæ–¼ AI æŠ€è¡“ç™¼å±•ï¼š", items: [
                        { t: "å½±åƒè¾¨è­˜è§£é–", cat: "YWk=" }, 
                        { t: "ç´…ç¶ ç‡ˆå®šæ™‚å™¨", cat: "bm90YWk=" }, 
                        { t: "ChatGPT ç”Ÿæˆæ–‡æ¡ˆ", cat: "YWk=" },
                        { t: "è¨ˆç®—æ©Ÿé–‹å¹³æ–¹æ ¹", cat: "bm90YWk=" }
                    ]}
                ]
            },
            {
                level: 2,
                title: "LEVEL 2ï¼šAI ç”Ÿæ´»æ‡‰ç”¨",
                questions: [
                    { type: 'choice', q: "AI èƒ½å¤ è¾¨è­˜æ‰‹å¯«æ•¸å­—æˆ–ç…§ç‰‡ä¸­çš„è²“ï¼Œæ˜¯å› ç‚ºä½¿ç”¨äº†å“ªç¨®é—œéµæŠ€è¡“ä¾†å¾ç¶“é©—ä¸­å­¸ç¿’ï¼Ÿ", options: ["å¤§æ•¸æ“šæ¬é‹", "æ©Ÿå™¨å­¸ç¿’ (Machine Learning)", "äººåŠ›é›²ç«¯è¼¸å…¥", "å€å¡ŠéˆåŠ å¯†"], a: "æ©Ÿå™¨å­¸ç¿’ (Machine Learning)" },
                    { type: 'match', q: "å°‡ AI æ‡‰ç”¨èˆ‡å…¶èƒŒå¾Œçš„æŠ€è¡“åŠŸèƒ½æ­£ç¢ºé…å°ï¼š", pairs: [
                        { l: "è‡ªé§•è»Šåµæ¸¬éšœç¤™", r: "é›»è…¦è¦–è¦º (CV)", id: 1 },
                        { l: "ç¿»è­¯ç­†å³æ™‚å°è©±", r: "è‡ªç„¶èªè¨€è™•ç† (NLP)", id: 2 },
                        { l: "æ™ºæ…§é†«ç™‚ç¯©é¸ç—…ç¶", r: "é†«å­¸å½±åƒåˆ†æ", id: 3 }
                    ]}
                ]
            },
            {
                level: 3,
                title: "LEVEL 3ï¼šDeepfake èˆ‡å€«ç†æ³•å¾‹",
                questions: [
                    { type: 'tf', q: "Deepfake æŠ€è¡“åƒ…åƒ…æ˜¯è»Ÿé«”åˆæˆï¼Œåªè¦æ²’æœ‰é‡‘éŒ¢è©é¨™ï¼Œå°±ä¸æœƒè§¸æ³•ã€‚", a: "RmFsc2U=" },
                    { type: 'choice', q: "åœ¨ä½¿ç”¨ AI ç”Ÿæˆåœ–åƒæˆ–æ–‡ç« æ™‚ï¼Œå“ªä¸€é …æ˜¯æœ€éœ€è¦æ³¨æ„çš„å€«ç†å•é¡Œï¼Ÿ", options: ["é›»è…¦é‹ç®—é€Ÿåº¦", "ç”Ÿæˆå…§å®¹çš„æ™ºæ…§è²¡ç”¢æ¬Šèˆ‡åè¦‹", "é¡¯ç¤ºå™¨è¢å¹•è§£æåº¦", "æª”æ¡ˆå„²å­˜æ ¼å¼"], a: "ç”Ÿæˆå…§å®¹çš„æ™ºæ…§è²¡ç”¢æ¬Šèˆ‡åè¦‹" },
                    { type: 'rush', q: "ã€æ¶ç­”ã€‘è‹¥åœ¨ç¶²è·¯ä¸Šçœ‹åˆ°åäººèªªå‡ºé•æ³•è¨€è«–ï¼Œç¬¬ä¸€æ­¥æ‡‰åšä»€éº¼ï¼Ÿ", options: ["ç«‹å³æˆªåœ–è½‰è²¼åˆ†äº«", "æŸ¥è­‰æ˜¯å¦ç‚º Deepfake è®Šè‡‰å½±ç‰‡", "ä¸‹è¼‰å½±ç‰‡æ°¸ä¹…ä¿å­˜", "ç›´æ¥åœ¨åº•ä¸‹ç•™è¨€é–‹ç½µ"], a: "æŸ¥è­‰æ˜¯å¦ç‚º Deepfake è®Šè‡‰å½±ç‰‡" }
                ]
            }
        ];

        let currentUser = { class: '', no: '', name: '' };
        let currentLevel = 0;
        let currentQIdx = 0;
        let score = 0;
        let totalCorrect = 0;
        let totalTime = 0;
        let gameTimer;
        let rushTimerInterval;
        let gasUrl = "https://script.google.com/macros/s/AKfycbzucU67nYMhc6hdjV2E1Z5mPckxnhHMmjegb0YHqbizKWMblQ8x6N7LeJfsPY_CK6Ddgg/exec"; 

        // è¿½è¹¤é–±è®€é€²åº¦
        let readProgress = [false, false, false];

        function startApp() {
            currentUser.class = document.getElementById('user-class').value;
            currentUser.no = document.getElementById('user-no').value;
            currentUser.name = document.getElementById('user-name').value;

            if (!currentUser.class || !currentUser.no || !currentUser.name) {
                alert("è«‹å¡«å¯«å®Œæ•´è³‡è¨Šï¼");
                return;
            }

            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('game-container').classList.remove('hidden');
            document.getElementById('display-info').innerText = `${currentUser.class} ç­ ${currentUser.no}è™Ÿ ${currentUser.name}`;
            
            startGlobalTimer();
            loadLevel(0);
        }

        function startGlobalTimer() {
            gameTimer = setInterval(() => {
                totalTime++;
                document.getElementById('timer-text').innerText = totalTime + 's';
            }, 1000);
        }

        function loadLevel(idx) {
            currentLevel = idx;
            currentQIdx = 0;
            updateNav();
            loadQuestion();
            updateNotes(idx);
        }

        function updateNav() {
            for(let i=1; i<=3; i++) {
                const nav = document.getElementById(`nav-${i}`);
                if (i-1 === currentLevel) {
                    nav.classList.add('text-purple-600', 'border-purple-400');
                    nav.classList.remove('text-gray-400');
                } else if (i-1 < currentLevel) {
                    nav.classList.add('text-green-500', 'border-green-300');
                    nav.classList.remove('text-purple-600', 'text-gray-400');
                }
            }
            const progress = (currentLevel / 3) * 100 + ((currentQIdx / levelsData[currentLevel].questions.length) * 33);
            document.getElementById('energy-fill').style.width = progress + '%';
        }

        function updateNotes(levelIdx) {
            const notesEl = document.getElementById('study-notes');
            const statusEl = document.getElementById('read-status');
            const btnEl = document.getElementById('btn-confirm-read');
            
            let content = "";
            const isRead = readProgress[levelIdx];
            
            if(levelIdx === 0) {
                content = `
                    <div class="study-note ${isRead ? 'read' : ''}"><h4 class="font-bold">AI åŸºç¤</h4><p class="text-sm">äººå·¥æ™ºæ…§æ—¨åœ¨æ¨¡ä»¿äººé¡æ™ºæ…§ã€‚ç›®å‰æˆ‘å€‘ä½¿ç”¨çš„å¤šç‚ºã€Œå¼± AIã€ï¼Œå³å°ˆæ³¨æ–¼è§£æ±ºå–®ä¸€ç‰¹å®šå•é¡Œçš„æŠ€è¡“ã€‚</p></div>
                    <div class="study-note ${isRead ? 'read' : ''}"><h4 class="font-bold">åˆ†è¾¨é—œéµ</h4><p class="text-sm">AI èˆ‡å‚³çµ±ç¨‹å¼æœ€å¤§çš„ä¸åŒåœ¨æ–¼ï¼ŒAI å…·æœ‰å­¸ç¿’èˆ‡å„ªåŒ–çš„èƒ½åŠ›ï¼Œè€Œä¸åƒ…åƒ…æ˜¯åŸ·è¡Œæ­»æ¿çš„é è¨­æŒ‡ä»¤ã€‚</p></div>
                `;
            } else if(levelIdx === 1) {
                content = `
                    <div class="study-note ${isRead ? 'read' : ''}"><h4 class="font-bold">æ©Ÿå™¨å­¸ç¿’ (ML)</h4><p class="text-sm">AI çš„ä¸€å€‹åˆ†æ”¯ï¼Œé€éæ•¸æ“šè¨“ç·´æ¨¡å‹ã€‚ä¾‹å¦‚ï¼šè—‰ç”±æ•¸è¬å¼µç…§ç‰‡è®“æ¨¡å‹å­¸æœƒåˆ†è¾¨ã€Œè²“ã€èˆ‡ã€Œç‹—ã€ã€‚</p></div>
                    <div class="study-note ${isRead ? 'read' : ''}"><h4 class="font-bold">æ‡‰ç”¨é ˜åŸŸ</h4><p class="text-sm">é›»è…¦è¦–è¦º (è¾¨è­˜åœ–åƒ)ã€è‡ªç„¶èªè¨€è™•ç† (èªéŸ³ç¿»è­¯) èˆ‡å¤§æ•¸æ“šæ¨è–¦ç³»çµ±éƒ½æ˜¯å¸¸è¦‹æ‡‰ç”¨ã€‚</p></div>
                `;
            } else {
                content = `
                    <div class="study-note ${isRead ? 'read' : ''}"><h4 class="font-bold">Deepfake æŠ€è¡“</h4><p class="text-sm">åˆ©ç”¨æ·±åº¦å­¸ç¿’åˆæˆå½é€ çš„è‡‰éƒ¨æˆ–è²éŸ³ã€‚é€™å¯èƒ½æ¶‰åŠå¦¨å®³ç§˜å¯†ã€èº«ä»½è©é¨™åŠæ€§éš±ç§æ¬Šä¿è­·æ³•ã€‚</p></div>
                    <div class="study-note ${isRead ? 'read' : ''}"><h4 class="font-bold">å€«ç†è¦ç¯„</h4><p class="text-sm">æˆ‘å€‘å¿…é ˆæ³¨æ„ AI å¯èƒ½ç”¢ç”Ÿçš„ç®—æ³•åè¦‹ã€éš±ç§ä¾µçŠ¯ä»¥åŠç‰ˆæ¬Šæ­¸å±¬å•é¡Œã€‚</p></div>
                `;
            }
            notesEl.innerHTML = content;
            
            if(isRead) {
                statusEl.innerText = "é–±è®€å®Œæˆ âœ…";
                statusEl.className = "text-xs bg-green-100 px-2 py-1 rounded text-green-600";
                btnEl.disabled = true;
                btnEl.innerText = "å·²å®Œæˆé–±è®€";
                btnEl.className = "w-full py-2 bg-green-50 text-green-500 rounded-lg text-sm font-bold cursor-default";
            } else {
                statusEl.innerText = "å°šæœªé–±è®€";
                statusEl.className = "text-xs bg-gray-100 px-2 py-1 rounded text-gray-400";
                btnEl.disabled = false;
                btnEl.innerText = "æˆ‘å·²é–±è®€å®Œç•¢ (åŠ åˆ†é …)";
                btnEl.className = "w-full py-2 bg-purple-50 text-purple-600 rounded-lg text-sm font-bold hover:bg-purple-100 transition shadow-sm";
            }
        }

        function markAsRead() {
            readProgress[currentLevel] = true;
            updateNotes(currentLevel);
        }

        function loadQuestion() {
            const level = levelsData[currentLevel];
            const q = level.questions[currentQIdx];
            const area = document.getElementById('content-area');
            const box = document.getElementById('question-box');
            const rushTimerEl = document.getElementById('rush-timer');
            
            box.classList.remove('correct-glow', 'wrong-shake');
            rushTimerEl.classList.add('hidden');
            clearInterval(rushTimerInterval);

            let html = `<h2 class="text-xl font-bold mb-4 text-gray-700">${level.title} - ç¬¬ ${currentQIdx + 1} é¡Œ</h2>`;
            html += `<p class="text-lg mb-6 leading-relaxed">${q.q}</p>`;

            if (q.type === 'tf') {
                html += `
                    <div class="flex space-x-4">
                        <button onclick="checkAnswer('True')" class="flex-1 py-6 rounded-xl border-2 hover:bg-blue-50 transition font-bold text-3xl">â­•</button>
                        <button onclick="checkAnswer('False')" class="flex-1 py-6 rounded-xl border-2 hover:bg-red-50 transition font-bold text-3xl">âŒ</button>
                    </div>
                `;
            } else if (q.type === 'choice' || q.type === 'rush') {
                if (q.type === 'rush') {
                    rushTimerEl.classList.remove('hidden');
                    startRushTimer(10);
                }
                html += `<div class="grid grid-cols-1 gap-3">`;
                q.options.forEach(opt => {
                    html += `<button onclick="checkAnswer('${opt}')" class="w-full py-3 px-4 text-left rounded-lg border-2 hover:border-purple-300 hover:bg-purple-50 transition text-sm md:text-base">${opt}</button>`;
                });
                html += `</div>`;
            } else if (q.type === 'drag') {
                html += `
                    <div class="space-y-4">
                        <div class="flex flex-wrap gap-2 mb-4" id="drag-items">
                            ${q.items.map((it, i) => `<div draggable="true" ondragstart="onDragStart(event, ${i})" class="bg-white border-2 border-blue-200 p-2 rounded cursor-move shadow-sm text-sm">${it.t}</div>`).join('')}
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="drop-zone p-4" ondragover="onDragOver(event)" ondrop="onDrop(event, 'YWk=')"><p class="text-xs text-gray-400 mb-2">åŸºæ–¼ AI æŠ€è¡“</p></div>
                            <div class="drop-zone p-4" ondragover="onDragOver(event)" ondrop="onDrop(event, 'bm90YWk=')"><p class="text-xs text-gray-400 mb-2">å‚³çµ±ç¨‹å¼/è¨ˆç®—</p></div>
                        </div>
                        <button onclick="checkDragAnswer()" class="btn-neon w-full mt-4">ç¢ºèªåˆ†é¡</button>
                    </div>
                `;
            } else if (q.type === 'match') {
                html += `<p class="text-sm text-gray-400 mb-4">é»æ“Šå·¦å´å†é»æ“Šå³å´ä¾†é…å°ï¼š</p>
                    <div class="flex justify-between space-x-4">
                        <div class="flex-1 space-y-2">
                            ${q.pairs.map(p => `<button id="l-${p.id}" onclick="selectMatch('l', ${p.id})" class="w-full p-2 border rounded bg-white text-xs text-left">${p.l}</button>`).join('')}
                        </div>
                        <div class="flex-1 space-y-2">
                            ${q.pairs.sort(() => Math.random()-0.5).map(p => `<button id="r-${p.id}" onclick="selectMatch('r', ${p.id})" class="w-full p-2 border rounded bg-white text-xs text-left">${p.r}</button>`).join('')}
                        </div>
                    </div>
                    <button onclick="checkMatchAnswer()" class="btn-neon w-full mt-4">å®Œæˆé…å°</button>
                `;
            }

            area.innerHTML = html;
        }

        function startRushTimer(sec) {
            let left = sec;
            const el = document.getElementById('rush-timer');
            el.innerText = left;
            rushTimerInterval = setInterval(() => {
                left--;
                el.innerText = left;
                if (left <= 0) {
                    clearInterval(rushTimerInterval);
                    handleAnswer(false);
                }
            }, 1000);
        }

        let draggedItemIdx = null;
        window.onDragStart = (e, idx) => { draggedItemIdx = idx; };
        window.onDragOver = (e) => { e.preventDefault(); e.currentTarget.classList.add('active'); };
        window.onDrop = (e, cat) => {
            e.preventDefault();
            e.currentTarget.classList.remove('active');
            const level = levelsData[currentLevel];
            const q = level.questions[currentQIdx];
            q.items[draggedItemIdx].userCat = cat;
            const itemEl = document.querySelector(`[ondragstart="onDragStart(event, ${draggedItemIdx})"]`);
            e.currentTarget.appendChild(itemEl);
        };

        function checkDragAnswer() {
            const q = levelsData[currentLevel].questions[currentQIdx];
            const isAllCorrect = q.items.every(it => it.cat === it.userCat);
            handleAnswer(isAllCorrect);
        }

        let selectedL = null;
        let selectedR = null;
        let userMatches = [];
        window.selectMatch = (side, id) => {
            if(side === 'l') {
                document.querySelectorAll("[id^='l-']").forEach(b => b.classList.remove('bg-purple-100'));
                selectedL = id;
                document.getElementById(`l-${id}`).classList.add('bg-purple-100');
            }
            if(side === 'r') {
                document.querySelectorAll("[id^='r-']").forEach(b => b.classList.remove('bg-purple-100'));
                selectedR = id;
                document.getElementById(`r-${id}`).classList.add('bg-purple-100');
            }
            if(selectedL && selectedR) {
                userMatches = userMatches.filter(m => m.l !== selectedL);
                userMatches.push({l: selectedL, r: selectedR});
                document.getElementById(`l-${selectedL}`).classList.remove('bg-purple-100');
                document.getElementById(`r-${selectedR}`).classList.remove('bg-purple-100');
                document.getElementById(`l-${selectedL}`).classList.add('bg-green-100');
                document.getElementById(`r-${selectedR}`).classList.add('bg-green-100');
                selectedL = selectedR = null;
            }
        };

        function checkMatchAnswer() {
            const q = levelsData[currentLevel].questions[currentQIdx];
            const correctCount = userMatches.filter(m => m.l === m.r).length;
            handleAnswer(correctCount === q.pairs.length);
            userMatches = [];
        }

        function checkAnswer(userAns) {
            clearInterval(rushTimerInterval);
            const q = levelsData[currentLevel].questions[currentQIdx];
            let isCorrect = (q.type === 'tf') ? (_A(userAns) === q.a) : (userAns === q.a);
            handleAnswer(isCorrect);
        }

        function handleAnswer(isCorrect) {
            const box = document.getElementById('question-box');
            if (isCorrect) {
                box.classList.add('correct-glow');
                score += 10;
                totalCorrect++;
                document.getElementById('score-text').innerText = score;
            } else {
                box.classList.add('wrong-shake');
            }
            setTimeout(() => { nextQuestion(); }, 800);
        }

        function nextQuestion() {
            currentQIdx++;
            if (currentQIdx >= levelsData[currentLevel].questions.length) {
                currentLevel++;
                if (currentLevel >= levelsData.length) {
                    finishGame();
                } else {
                    loadLevel(currentLevel);
                }
            } else {
                updateNav();
                loadQuestion();
            }
        }

        function finishGame() {
            clearInterval(gameTimer);
            document.getElementById('game-container').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');
            
            const allRead = readProgress.every(r => r === true);
            let finalScore = score;
            if (allRead) {
                finalScore = Math.round(score * 1.05 * 10) / 10;
                document.getElementById('bonus-row').classList.remove('hidden');
            }

            document.getElementById('final-correct').innerText = totalCorrect + " é¡Œ";
            document.getElementById('final-raw-score').innerText = score + " åˆ†";
            document.getElementById('final-score').innerText = finalScore + " åˆ†";
            document.getElementById('final-time').innerText = totalTime + " ç§’";
            
            uploadData(finalScore, allRead);
        }

        function showAdminLogin() { document.getElementById('admin-login').classList.remove('hidden'); }
        function hideAdminLogin() { document.getElementById('admin-login').classList.add('hidden'); }
        function checkAdmin() {
            const pass = document.getElementById('admin-pass').value;
            if (_A(pass) === _S) {
                window.open("https://docs.google.com/spreadsheets/d/19rzBcUZLWQBexhKsqvww-oxjMZbgQBFpqoUdliGvjJM/edit", "_blank");
            } else {
                alert("å¯†ç¢¼éŒ¯èª¤ï¼");
            }
        }

        async function uploadData(finalScore, isBonus) {
            const payload = {
                class: currentUser.class,
                no: currentUser.no,
                name: currentUser.name,
                level: "Completed",
                correct: totalCorrect,
                rawScore: score,
                finalScore: finalScore,
                studyBonus: isBonus ? "Yes" : "No",
                time: totalTime,
                date: new Date().toLocaleString()
            };

            try {
                await fetch(gasUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    cache: 'no-cache',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
            } catch (e) { console.error("Upload error", e); }
        }
    </script>
</body>
</html>
